<launch>
    <arg name="use_sim_time" default="false"/>

    <arg name="rviz" default="true"/>
    <arg name="map" default=""/>

    <arg name="oneshot" default="false"/> <!-- disregard path updates unless navigation is restarted -->

    <node name="central_node" pkg="central_nav" exec="central_node" output="screen">
        <remap from="robot_poses" to="/robot_poses"/>
        <remap from="robot_paths" to="/robot_paths"/>
        <remap from="robot_pass" to="/robot_pass"/>
        <remap from="robot_stop" to="/robot_stop"/>
        <remap from="robot_markers" to="/robot_markers"/>
        <remap from="path_markers" to="/path_markers"/>
        <remap from="ix_markers" to="/ix_markers"/>
        <param name="use_sim_time" value="$(var use_sim_time)"/>
        <param name="oneshot" value="$(var oneshot)"/>    
    </node>

    <!-- VISUALISATION -->

    <group if="$(var rviz)">
        <group if="$(eval '\'$(var map)\' != \'\'')">
            <node pkg="nav2_map_server" exec="map_server" name="map_server">
                <param name="yaml_filename" value="$(var map)" />
            </node>
            <executable cmd="$(find-pkg-share central_nav)/scripts/start_map_server.sh" output="screen"/>
        </group>

        <node pkg="rviz2" exec="rviz2" name="robots_rviz" args="-d $(find-pkg-share central_nav)/rviz/robots.rviz">
            <param name="use_sim_time" value="$(var use_sim_time)" />
        </node>
    </group>
</launch>